#working files
import shlex, subprocess
import sys
import os
import copy
import string
import csv
from pathlib import Path

row_list=["obj","endobj","stream","endstream","xref","trailer","startxref","page","encrypt","objstm","js","javascript","aa","openaction","acroform","jbig2decode","richmedia","launch","embeddedfile","xfa","colours"]
myFiles=[]
f=open("finalMalicious.csv",'w')
basepath = Path('collMalicious/')
files_in_basepath = basepath.iterdir()
for item in files_in_basepath:
    if item.is_file():
        myFiles.append(item.name)
str="python pdfid.py "
for filename in myFiles:
    try:
        cmd_line = str + os.path.join('./','collMalicious', filename)
        args = shlex.split(cmd_line)
        process = subprocess.Popen(args, stdout=subprocess.PIPE)
        res=[]
        for line in process.stdout:
            s=copy.deepcopy(line)
            res.append(s)
        
        fin=[]
        lines=[]
        for sp in res:
            sp=sp.split(" ")
            fin.append(sp)

        for item in fin:
            lines.append(item[-1])     
        lines[:] = [line.rstrip('\n') for line in lines]     
        lines = lines[2:-1]
        lines.append("1")  #0 for malicious
        print(lines)

        for item in lines:    
            f.writelines(item + ',')
        f.write("\n")
    except:
        print("skipped file " + filename)

f.close()
    #with open('cleanOut1.csv','a') as f:
    #    for item in lines:    
    #        f.write(item + ',')
    #    f.write('\n')
   
    #with open("out.csv", "w") as f:
    #    writer = csv.writer(f)
    #    writer.writerows(lines)